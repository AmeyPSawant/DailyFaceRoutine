<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Skincare Routine</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
    }

    h2 {
      margin-top: 40px;
      padding-bottom: 10px;
      border-bottom: 2px solid #ccc;
    }

    .routine {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 20px 0;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
    }

    input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }

    .am {
      background: linear-gradient(to right, #ffffff, #d4edff);
      padding: 20px;
      border-radius: 10px;
    }

    .pm {
      background: linear-gradient(to right, #1a1a2e, #3f0071);
      color: white;
      padding: 20px;
      border-radius: 10px;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      text-align: center;
      font-size: 2em;
    }

    #overlay.am {
      background: rgba(255, 255, 255, 0.8);
      color: #000;
    }

    #overlay.pm {
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>üß¥ Daily Skincare Tracker</h1>
  <div id="am-routine" class="am">
    <h2>‚òÄÔ∏è AM Routine</h2>
    <div class="routine" id="am-steps"></div>
  </div>

  <div id="pm-routine" class="pm">
    <h2>üåô PM Routine</h2>
    <div class="routine" id="pm-steps"></div>
  </div>

  <div id="overlay"></div>

  <script>
    // === Google Sheets Integration ===
    // Replace with your own published Google Sheets URL
    const sheetUrl = "https://docs.google.com/spreadsheets/d/1bnIeueU-AkhRVe6xbQBG7cxdIg8Q7IIhGRl_qBOk6qY";

    // Sheet 1: Routines (First row = AM/PM headers, First column = days)
    // Sheet 2: Timers (First column = Product, Second column = Wait time in seconds)

    async function fetchSheetData(sheetNumber = 1) {
      const base = sheetUrl.replace("/edit#gid=", "/gviz/tq?tqx=out:json&sheet=");
      const response = await fetch(`${base}${sheetNumber}`);
      const text = await response.text();
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows;
      return rows.map(row => row.c.map(cell => cell?.v || ""));
    }

    function getCurrentDay() {
      return new Date().toLocaleDateString("en-US", { weekday: 'short' });
    }

    function showOverlay(type, waitTime, step) {
      const overlay = document.getElementById("overlay");
      overlay.className = type;
      overlay.textContent = `${step} ‚Äî Please wait ${waitTime}s...`;
      overlay.style.display = "flex";

      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb => cb.disabled = true);

      let counter = waitTime;
      const interval = setInterval(() => {
        counter--;
        overlay.textContent = `${step} ‚Äî Please wait ${counter}s...`;
        if (counter <= 0) {
          clearInterval(interval);
          overlay.style.display = "none";
          checkboxes.forEach(cb => cb.disabled = false);
        }
      }, 1000);
    }

    async function init() {
      const currentDay = getCurrentDay();
      const [routineData, timerData] = await Promise.all([
        fetchSheetData(1),
        fetchSheetData(2)
      ]);

      const headers = routineData[0];
      const dayIndex = { Sun: 0, Mon: 1, Tue: 2, Wed: 3, Thu: 4, Fri: 5, Sat: 6 }[currentDay];
      const todayData = routineData[dayIndex + 1];

      const amSteps = todayData.slice(1, headers.indexOf("PM"));
      const pmSteps = todayData.slice(headers.indexOf("PM") + 1);

      const timers = {};
      timerData.forEach(([product, time]) => {
        if (product) timers[product.trim()] = parseInt(time);
      });

      createRoutineList(amSteps, "am-steps", "am", timers);
      createRoutineList(pmSteps, "pm-steps", "pm", timers);
    }

    function createRoutineList(steps, containerId, type, timers) {
      const container = document.getElementById(containerId);
      steps.forEach((step, idx) => {
        const stepId = `${containerId}-${idx}`;

        const div = document.createElement("div");
        div.className = "step";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = stepId;

        const label = document.createElement("label");
        label.htmlFor = stepId;
        label.textContent = step;

        checkbox.addEventListener("change", () => {
          if (checkbox.checked && timers[step]) {
            showOverlay(type, timers[step], step);
          }
        });

        div.appendChild(checkbox);
        div.appendChild(label);
        container.appendChild(div);
      });
    }

    init();
  </script>
</body>
</html>
